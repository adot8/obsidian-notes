![[Pasted image 20250916221334.png]]



| Step | Notes                                                                                                                                                                                                                                        |
| ---- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | - RIP value = the start of main<br>- No instructions yet<br>- RSP's value is the return address of the piece of code that called main; this got placed onto the stack after it called main; we need the return address to get back to it<br> |

![[Pasted image 20250916221757.png]]

| Step | Notes                                                                                                                  |
| ---- | ---------------------------------------------------------------------------------------------------------------------- |
| 2    | - `sub` is executed; `rsp = rsp - 28`<br>- RSPs value goes down by hex 28 and can be seen to be different on the stack |

![[Pasted image 20250916222053.png]]

| Step | Notes                                                                                                                                                                                                                                                                                                                                                                     |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 3    | - `call` is executed; calls the start of `func`<br>-  calling the new function will place a return address onto the stack<br>- **The return address will be the address of the function after the call or else it will make an infinite loop if it goes back to call after it's done**<br>- RSP also is decremented by 8 as the return address gets pushed onto the stack |
|      | - Call jumps to function<br>- ret  returns back to main, more specifically mov (140001019) and not call to avoid a loop                                                                                                                                                                                                                                                   |

![[Pasted image 20250916223159.png]]
![[Pasted image 20250916223442.png]]

> When moving a 32 bit value into a 64 bit register, it will fill in the remaining/upper 32 bits into the register (called zero extending)
> **THIS ONLY APPLIES TO REGISTERS AND NOT MEMORY**

| Step | Notes                                                          |
| ---- | -------------------------------------------------------------- |
| 4    | - RIP jumps to `func`<br>- `mov` is executed; eax(rax) = 0BEEF |
![[Pasted image 20250916223740.png]]

1.  The functions frame before mains frame just had a return address back to itself
2. Mains frame on the stack has a return address put there pointing to `mov` due to it calling `func`
3. `func` doesn't need to use it's stack frame as it's simply moving a value into a register which is a simple function

![[Pasted image 20250916224214.png]]

| Step | Notes                                                                                                                                                                                                     |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 5    | - ret (return) is executed<br>- This "pops" the value on the top of the stack off and into RIP so `mov` within main is executed next<br>- RSP is incremented by 8 and the previous frame is now undefined |

![[Pasted image 20250916224534.png]]


| Step | Notes                                                                                                                                                    |
| ---- | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 6    | - RIP is pointing to `mov`<br>- `mov` is executed and changes eax(rax) to 0F00D<br>- This is a simple operation and doesn't require changes to the stack |

![[Pasted image 20250916224657.png]]


| Step | Notes                                                                                                                                                                                             |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 7    | - `add` is executed; rsp = rsp + 28<br>- To get RSP back to the bottom of the stack `add` is used to balance out the first `sub` used<br>- This is better than using multiple pops and pushes<br> |

![[Pasted image 20250916224921.png]]


| Step | Notes                                                                                                                                                                   |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 8    | - ret (return) is executed<br>- This pops the return address off the stack and into RIP which goes back to whatever function called main<br>- RSP increments by 8 (pop) |

---

### Highlights

![[Pasted image 20250916225113.png]]

![[Pasted image 20250916225213.png]]

---

### Simple Stack Diagram
![[Pasted image 20250916225340.png]]

---

### VS Studio