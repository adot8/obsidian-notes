## IdentifyHosts
We can use `Wireshark` and `TCPDump` to "put our ear to the wire" and see what hosts and types of network traffic we can capture. This is particularly helpful if the assessment approach is "black box." We notice some [ARP](https://en.wikipedia.org/wiki/Address_Resolution_Protocol) requests and replies, [MDNS](https://en.wikipedia.org/wiki/Multicast_DNS), and other basic [layer two](https://www.juniper.net/documentation/us/en/software/junos/multicast-l2/topics/topic-map/layer-2-understanding.html) packets (since we are on a switched network, we are limited to the current broadcast domain).
#### Wireshark
Sniff out `ARP` and `MDNS `packets to covertly discover hosts
```shell
sudo -E wireshark
```
![[Pasted image 20250128064931.png]]
#### TCPdump
Sniff the same traffic and save to output to be viewed in wireshark
```bash
sudo tcpdump -i wlan0 -w - -U | tee tcpdump.out | tcpdump -r -
```
#### Responder
Put `Responder`into analyze mode to view `LLMNR`, `NBT-NS`, and `MDNS` traffic
```bash
sudo stdbuf -o0  responder -I wlan0 -A | tee responder.out
```
#### Fping
Discover live hosts and document in hosts.txt file
```bash
fping -asgq 172.16.5.0/23
```

```bash
#!/bin/bash
network="$1"
outfile=$2
# Discover live hosts
fping -asgq "$network" | tee /dev/tty | grep -oP '\d+\.\d+\.\d+\.\d+' > $outfile
echo "[+] Output saved to $outfile"
```
#### Nmap
```bash
nmap -v -A -iL hosts.txt -oA host_enum.out
```

## Identify Users
If our client does not provide us with a user to start testing with, we will need to find a way to establish a foothold in the domain by either obtaining clear text credentials or an `NTLM` password hash for a user, a `SYSTEM` shell on a domain-joined host, or a shell in the context of a domain user account. Obtaining a valid user with credentials is critical in the early stages of an internal penetration test. This access (even at the lowest level) opens up many opportunities to perform enumeration and even attacks.

Kerbrute takes advantage of the fact that Kerberos pre-authentication failures often will not trigger logs or alerts, which makes it
#### Kerbrute
Use `jsmith.txt` or `jsmith2.txt` user lists from [Insidetrust](https://github.com/insidetrust/statistically-likely-usernames)
```bash
kerbrute userenum -d DOMAIN.LOCAL --dc 172.16.5.5 jsmith.txt -o valid_ad_users
```
#### Netexec
```bash
netexec smb <IP> -u '' -p '' --rid-brute
```