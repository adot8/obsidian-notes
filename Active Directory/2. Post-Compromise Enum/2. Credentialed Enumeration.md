# Linux
#### BloodHound.py
```bash
sudo neo4j console
sudo bloodhound-python -d PNPT.local -u greg -p 'Password1' -ns 192.168.1.129 -c all
zip -r domain*.json
```
[Custom Cipher Queries](https://hausec.com/2019/09/09/bloodhound-cypher-cheatsheet/)
#### Domain User and Group
With **Netexec** we can filter out any accounts that have a`badPwdCount` more than **0** for password spraying, search for any **special groups** with **elevated privileges** and see if any **domain admins/special users are logged on**
```bash
netexec smb 172.16.5.5 -u forend -p Klmcargo2 --users
netexec smb 172.16.5.5 -u forend -p Klmcargo2 --groups
netexec smb 172.16.5.5 -u forend -p Klmcargo2 --loggedon-users
```
 Use **Windapsearch**  with `--da` to **discover domain admins** and use `--PU` to **discover users with elevated privileges**
```bash
python3 windapsearch.py --dc-ip 172.16.5.5 -u forend@inlanefreight.local -p Klmcargo2 --da
python3 windapsearch.py --dc-ip 172.16.5.5 -u forend@inlanefreight.local -p Klmcargo2 -PU
``````
**rpcclient**
```bash
rpcclient -U '' -N 172.16.5.5
enumdomusers
enumdomgroups
querydispinfo
queryuser joe
```
#### Shares
View read and writable shares and their contents with `spider_plus`
```bash
netexec smb 172.16.5.5 -u forend -p Klmcargo2 --shares
netexec smb 172.16.5.5 -u forend -p Klmcargo2 -M spider_plus --share 'IT Share'
```
**SMBMap** - List directories recursively within share. `--dir-only` provided only the output of all directories and did not list all files
```bash
smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5
smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5 -R 'IT Shares' --dir-only
```
# Windows
#### SharpHound.exe
```powershell
.\SharpHound.exe -c All --zipfilename SHDUMP
```
#### Snaffler - Shares
Snaffler can produce a considerable amount of data, so we should typically output to file and let it run and then come back to it later. It can also be helpful to provide Snaffler raw output to clients as supplemental data during a penetration test as it can help them zero in on high-value shares that should be locked down first.
```powershell
.\Snaffler.exe  -d INLANEFREIGHT.LOCAL -s -v data -o snaffler.log
```
#### ActiveDirectory PowerShell Module - OPSEC Friendly
```powershell
Get-Module
Import-Module ActiveDirectory
Get-ADDomain
Get-ADTrust -Filter *

Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName             <-- Find Kerberoastable accounts

Get-ADGroup -Filter * | select name
Get-ADGroup -Identity "Backup Operators"
Get-ADGroupMember -Identity "Backup Operators"
```
#### PowerView
###### Domain enumeration
```powershell
Get-Domain
Get-Domain -Domain moneycorp.local
Get-DomainSID

Get-DomainPolicyData
Get-DomainController
Get-DomainController -Domain moneycorp.local
```
###### Domain user and group enumeration
```bash
Get-DomainUser | select samaccountname
Get-DomainUser -Identity student1
Get-DomainUser -Identity student1 -Properties *
Get-DomainUser -Properties samaccountname,logonCount,Description
Get-DomainUser -LDAPFilter "Description=*built*" | Select name,Description
Get-DomainUser -Identity student -Domain inlanefreight.local | Select-Object -Property name,samaccountname,description,memberof,whencreated,pwdlastset,lastlogontimestamp,accountexpires,admincount,userprincipalname,serviceprincipalname,useraccountcontrol
```
> [!NOTE] Note
> Need to specify the domain for Enterprise Admins and others to show
```powershell
Get-DomainGroupMember -Identity "Domain Admins" -Recurse
Get-DomainGroup | select Name
Get-DomainGroup -Domain <targetdomain>
Get-DomainGroup *admin* | select cn

Get-DomainGroupMember -Identity "Domain Admins" -Recurse
Get-DomainGroupMember -Identity "Domain Admins" -Recurse | select MemberName
Get-DomainGroupMember -Identity "Enterprise Admins" -Recurse -domain <domain>
Get-DomainGroup -UserName "student1"
Get-DomainGroup -UserName "student1" | select name
```
###### Domain Trust enumeration
```powershell
Get-DomainTrustMapping
Get-DomainTrust -Domain other.inlanefreight.local
```
###### Test local admin access
```powershell
Test-AdminAccess -ComputerName ACADEMY-EA-MS01
```
###### Find users with SPNs
```powershell
Get-DomainUser -SPN -Properties samaccountname,ServicePrincipalName
```